<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Sheet FREE</title> 
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    
    <link rel="icon" href="favicon-96x96.png" sizes="96x96" type="image/png">
    <link rel="icon" href="web-app-manifest-192x192.png" sizes="192x192" type="image/png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="theme-color" content="#4db8ff">

    <style>
        /* „Éó„É≠Áâà„ÅÆCSS„Çí100%Á∂ôÊâø„ÄÇÊï∞Â≠ó„ÅÆÂ§ß„Åç„Åï„ÄÅ‰ΩôÁôΩ„ÄÅ„Åô„Åπ„Å¶„Éó„É≠‰ªïÊßò„Åß„Åô */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 8px; background-color: #f0f2f5; margin: 0; box-sizing: border-box; font-size: 16px; -webkit-text-size-adjust: 100%; color: #000; }
        * { box-sizing: border-box; }
        .app-grid { display: flex; gap: 12px; max-width: 1400px; margin: 0 auto; }
        .calculator-container { flex: 3; min-width: 0; background-color: #fff; padding: 12px; border-radius: 10px; box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1); width: 100%; }
        
        .row { display: flex; margin-bottom: 12px; padding: 12px; border: 1px solid #ccc; border-radius: 10px; background-color: #fff; gap: 8px; }
        
        @media screen and (max-width: 800px) {
            .row { flex-direction: column !important; align-items: stretch !important; }
            .text-label-input { width: 100% !important; font-size: 1.1em; padding: 10px; margin-bottom: 5px; }
            .calc-area { width: 100% !important; justify-content: center !important; padding: 10px 0; border-top: 1px dashed #eee; border-bottom: 1px dashed #eee; }
            .result-area { width: 100% !important; justify-content: space-between !important; background: #eefbff; padding: 12px; border-radius: 8px; }
            .result-text { font-size: 2.2em; } /* „Éó„É≠ÁâàÁâπÊúâ„ÅÆÂ§ß„Åç„Å™Êï∞Â≠ó */
        }

        @media screen and (min-width: 801px) {
            .row { flex-direction: row; align-items: center; justify-content: space-between; }
            .text-label-input { flex: 1.5; }
            .calc-area { flex: 1; justify-content: center; }
            .result-area { flex: 2; justify-content: flex-end; background: #f8f9fa; padding: 5px 10px; border-radius: 6px; }
            .result-text { font-size: 1.6em; }
        }

        .text-label-input { padding: 8px; border: 2px solid #000; border-radius: 6px; font-weight: bold; color: #000; outline: none; }
        .calc-area { display: flex; align-items: center; gap: 8px; }
        .multiplier-input { width: 110px; font-size: 1.5em; padding: 8px; text-align: right; border: 3px solid #007bff; border-radius: 6px; font-weight: bold; color: #000; outline: none; }
        .result-text { font-weight: bold; color: #007bff; }
        
        .operator-group { display: flex; flex-direction: column; align-items: center; width: 32px; }
        .operator-control { font-size: 0.7em; background: #333; color: #fff; width: 100%; height: 20px; display: flex; justify-content: center; align-items: center; border-radius: 3px; cursor: pointer; }
        .operator-display { font-size: 1.6em; font-weight: bold; text-align: center; color: #000; height: 35px; line-height: 35px; width: 100%; }

        .percent-toggle, .base-toggle { border: 2px solid #ccc; border-radius: 6px; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; background: #fff; font-size: 1.3em; flex-shrink: 0; color: #000; user-select: none; }
        .percent-toggle.active { background: #dc3545; color: #fff; border-color: #dc3545; }
        .base-toggle.chain { background: #007bff; color: #fff; border-color: #007bff; }
        
        .action-btn { border: none; background: none; cursor: pointer; font-size: 1.8em; opacity: 0.7; padding: 5px; }

        .master-row { padding: 12px; margin-bottom: 12px; border: 3px solid #dc3545; border-radius: 10px; background-color: #fff; display: flex; align-items: center; justify-content: space-between; }
        .master-input { width: 45%; padding: 8px; border: 2px solid #dc3545; border-radius: 6px; font-size: 1.5em; text-align: right; font-weight: bold; color: #000; outline: none; }

        .storage-bar { background: #dee2e6; border: 2px solid #666; border-radius: 10px; padding: 10px; margin-bottom: 12px; display: flex; flex-direction: column; gap: 8px; }
        .storage-controls { display: flex; align-items: center; gap: 10px; }
        .save-btn-main { background: #e67e22; color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; white-space: nowrap; }
        .edit-toggle-btn { background: #6c757d; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.8em; }
        .save-list-container { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; min-height: 40px; align-items: center; }

        .side-calc { flex: 1; min-width: 280px; background: #333; padding: 12px; border-radius: 10px; color: white; height: fit-content; position: sticky; top: 8px; }
        .calc-display { width: 100%; height: 52px; background: #222; color: #fff; text-align: right; font-size: 1.8em; padding: 8px; border-radius: 6px; margin-bottom: 8px; border:none; outline:none; }
        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .calc-btn { padding: 15px 5px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.25em; font-weight: bold; background: #555; color: white; }
        .calc-btn.op { background: #f39c12; }
        .calc-btn.equal { background: #27ae60; grid-column: span 2; }
        .calc-btn.clear { background: #c0392b; }

        .mode-toggle { display: flex; gap: 8px; margin-bottom: 12px; }
        .mode-button { flex: 1; padding: 12px 8px; border: none; background: #ddd; border-radius: 8px; cursor: pointer; font-weight: bold; display: flex; flex-direction: column; align-items: center; min-height: 85px; color: #000; transition: 0.2s; }
        .mode-button.active { background-color: #007bff; color: white; }
        .mode-desc { font-size: 0.7em; margin-top: 6px; opacity: 0.9; font-weight: normal; line-height: 1.3; text-align: center; }
        .util-btn { border: none; background: #6c757d; color: white; padding: 8px 10px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: bold; }
        
        #saveMessage { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); background: #dc3545; color: #fff; padding: 12px 25px; border-radius: 25px; opacity: 0; transition: opacity 0.3s; z-index: 2000; pointer-events: none; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-align: center; }
        .calc-toggle-btn { display: none; position: fixed; bottom: 15px; right: 15px; width: 60px; height: 60px; border-radius: 50%; background: #333; color: white; border: none; font-size: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1001; }

        @media screen and (max-width: 900px) {
            .side-calc { display: none; position: fixed; bottom: 80px; right: 15px; z-index: 1000; width: 280px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
            .side-calc.active { display: block; }
            .calc-toggle-btn { display: block; }
        }
    </style>
</head>
<body onload="init()">

    <div id="saveMessage"></div>
    <button class="calc-toggle-btn" onclick="toggleCalc()">üßÆ</button>

    <div class="app-grid">
        <div class="calculator-container">
            <div class="top-controls" style="display:flex; justify-content: space-between; align-items: center; margin-bottom:10px; flex-wrap: wrap; gap:8px;">
                <div style="flex:1; display:flex; align-items:center; border:2px solid #000; border-radius:6px; padding:6px 10px; min-width:180px; background:#fff;">
                    <span id="labelNameSpan" style="font-size:0.8em; color:#000; font-weight:bold; margin-right:8px;">Name:</span>
                    <input type="text" id="masterLabel" style="border:none; outline:none; font-weight:bold; width:100%; color:#000;">
                </div>
                <div id="langContainer" style="display:flex; gap:3px; flex-wrap: wrap;"></div>
            </div>

            <div class="storage-bar">
                <div class="storage-controls">
                    <button class="save-btn-main" onclick="showProGuide()">üíæ <span id="btnSaveMemory">Ë®òÊÜ∂„Åô„Çã</span></button>
                    <button id="editToggle" class="edit-toggle-btn" onclick="showProGuide()">Edit ‚úé</button>
                    <span style="color:#dc3545; font-size:0.7em; font-weight:bold;">FREE VERSION</span>
                </div>
                <div id="saveList" class="save-list-container"></div>
            </div>

            <h2 id="title" style="font-weight: bold; margin-bottom: 12px;">Simple Sheet</h2>

            <div class="utility-bar" style="display:flex; justify-content: center; gap:4px; margin-bottom:12px; flex-wrap:wrap;">
                <button class="util-btn" onclick="clearNumbers()">üßπ <span id="btnClear">Clear</span></button>
                <button class="util-btn" onclick="showProGuide()">üì§ <span id="btnExport">Exp</span></button>
                <button class="util-btn" onclick="showProGuide()">üì• <span id="btnImport">Imp</span></button>
                <button class="util-btn" style="background:#dc3545;" onclick="fullReset()">üîÑ <span id="btnReset">Reset</span></button>
            </div>

            <div class="mode-toggle" style="display:flex; gap:8px; margin-bottom:12px;">
                <button id="smartSheetBtn" class="mode-button active" onclick="switchMode('smartSheet')">
                    <span id="txtModeBase">From Base</span>
                    <span id="descModeBase" class="mode-desc"></span>
                </button>
                <button id="customSimpleBtn" class="mode-button" onclick="switchMode('customSimple')">
                    <span id="txtModePrev">Flow</span>
                    <span id="descModePrev" class="mode-desc"></span>
                </button>
            </div>

            <div id="smart-sheet-mode">
                <div class="master-row">
                    <label id="masterLabelStart" style="font-weight:bold; color:#dc3545;">Base Value</label>
                    <input type="number" id="masterInput" class="master-input" value="1000" oninput="updateDisplay()">
                </div>
                <div id="rows-container-smart"></div>
                <div style="text-align: center; margin-top: 15px; display: flex; gap: 8px;">
                    <button class="mode-button" id="addBtnInd" style="background:#28a745; color:white; flex-direction:row; min-height:auto;" onclick="addRowSmart()">+ Row</button>
                    <button class="mode-button" id="copyBtnInd" style="background:#007bff; color:white; flex-direction:row; min-height:auto;" onclick="copyPage('smart')">Copy All</button>
                </div>
            </div>

            <div id="custom-simple-mode" style="display: none;">
                <div class="master-row">
                    <label id="masterLabelStartSimple" style="font-weight:bold; color:#dc3545;">Base Value</label>
                    <input type="number" id="masterInputSimple" class="master-input" value="1000" oninput="updateDisplay()">
                </div>
                <div id="rows-container-simple"></div>
                <div style="text-align: center; margin-top: 15px; display: flex; gap: 8px;">
                    <button class="mode-button" id="addBtnSeq" style="background:#28a745; color:white; flex-direction:row; min-height:auto;" onclick="addRowSimple()">+ Row</button>
                    <button class="mode-button" id="copyBtnSeq" style="background:#007bff; color:white; flex-direction:row; min-height:auto;" onclick="copyPage('custom')">Copy All</button>
                </div>
            </div>
        </div>

        <div id="sideCalc" class="side-calc">
            <h3 id="ui-calcTitle" style="margin:0 0 10px;">Calculator</h3>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <input type="text" id="calcDisplay" class="calc-display" readonly value="0">
                <button class="calc-btn" style="background:#007bff; width:52px;" onclick="copyCalcResult()">üìã</button>
            </div>
            <div class="calc-buttons">
                <button class="calc-btn clear" onclick="calcClear()">AC</button>
                <button class="calc-btn op" onclick="calcInput('%')">%</button>
                <button class="calc-btn op" onclick="calcInput('/')">√∑</button>
                <button class="calc-btn op" onclick="calcInput('*')">√ó</button>
                <button class="calc-btn" onclick="calcInput('7')">7</button>
                <button class="calc-btn" onclick="calcInput('8')">8</button>
                <button class="calc-btn" onclick="calcInput('9')">9</button>
                <button class="calc-btn op" onclick="calcInput('-')">-</button>
                <button class="calc-btn" onclick="calcInput('4')">4</button>
                <button class="calc-btn" onclick="calcInput('5')">5</button>
                <button class="calc-btn" onclick="calcInput('6')">6</button>
                <button class="calc-btn op" onclick="calcInput('+')">+</button>
                <button class="calc-btn" onclick="calcInput('1')">1</button>
                <button class="calc-btn" onclick="calcInput('2')">2</button>
                <button class="calc-btn" onclick="calcInput('3')">3</button>
                <button class="calc-btn" onclick="calcInput('.')">.</button>
                <button class="calc-btn" onclick="calcInput('0')">0</button>
                <button class="calc-btn" onclick="calcInput('00')">00</button>
                <button class="calc-btn equal" onclick="calcResult()">=</button>
            </div>
        </div>
    </div>

    <script>
        // „Éó„É≠Áâà„ÅÆÂÖ®9Ë®ÄË™û„Éá„Éº„Çø„ÇíÂÆåÁíß„Å´ÁßªÊ§ç
        const languageMap = {
            en: { proGuide: "PRO adds: Local saving and data export/import.", modeBase: "From Base", descBase: "Fixed: Every row refers to the top value", modePrev: "Flow", descPrev: "Evaluated from top to bottom. Choose üè† or üîó for each row.", masterLabelName: "Name:", masterLabelStart: "Base Value", copyMsg: "Copied!", btnClear: "Clear", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", addRow: "+ Row", copyAll: "Copy All", calcTitle: "Calculator", btnSave: "Save", confirmReset: "Reset all?" },
            ja: { proGuide: "„Éó„É≠Áâà„Åß„ÅØ„ÄÅÁ´ØÊú´ÂÜÖ‰øùÂ≠ò„Å®„Éá„Éº„Çø„ÅÆÊõ∏„ÅçÂá∫„Åó„ÉªË™≠„ÅøËæº„Åø„Åå‰Ωø„Åà„Åæ„Åô„ÄÇ", modeBase: "ÂÖÉ„ÅÆÂÄ§„Åã„Çâ", descBase: "Âõ∫ÂÆöÂèÇÁÖßÔºö„Åô„Åπ„Å¶„ÅÆË°å„Åå‰∏ÄÁï™‰∏ä„ÅÆÊï∞ÂÄ§„ÇíÂèÇÁÖß„Åó„Åæ„Åô", modePrev: "„Éï„É≠„ÉºË®àÁÆó", descPrev: "‰∏ä„Åã„ÇâÈ†Ü„Å´Ë®àÁÆó„ÄÇÂêÑË°å„Åß üè† „Åæ„Åü„ÅØ üîó „ÇíÈÅ∏ÊäûÂèØËÉΩ„ÄÇ", masterLabelName: "Ë®àÁÆóÂêç:", masterLabelStart: "ÂÖÉ„ÅÆÊï∞Â≠ó", copyMsg: "„Ç≥„Éî„ÉºÂÆå‰∫Ü", btnClear: "„ÇØ„É™„Ç¢", btnExport: "Âá∫Âäõ", btnImport: "Ë™≠Ëæº", btnReset: "ÂàùÊúüÂåñ", addRow: "+ Ë°åËøΩÂä†", copyAll: "ÂÖ®„Ç≥„Éî„Éº", calcTitle: "ÈõªÂçì", btnSave: "Ë®òÊÜ∂„Åô„Çã", confirmReset: "ÂÖ®„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü" },
            zh: { proGuide: "‰∏ì‰∏öÁâàÂ¢ûÂä†ÔºöÊú¨Âú∞‰øùÂ≠òÂíåÊï∞ÊçÆÂØºÂá∫/ÂØºÂÖ•„ÄÇ", modeBase: "Êù•Ëá™ÂàùÂßãÂÄ§", descBase: "Âõ∫ÂÆöÂèÇÁÖßÔºöÊØè‰∏ÄË°åÈÉΩÂºïÁî®È°∂ÈÉ®„ÅÆÂàùÂßãÂÄºËøõË°åËÆ°ÁÆó", modePrev: "ÊµÅÁ®ãÊ®°Âºè", descPrev: "Ëá™‰∏äËÄå‰∏ã‰æùÊ¨°ËÆ°ÁÆó„ÄÇÊØèË°åÂèØÈÄâÊã© üè† Êàñ üîó Ê®°Âºè„ÄÇ", masterLabelName: "ÂêçÁß∞:", masterLabelStart: "ÂàùÂßãÂÄ§", copyMsg: "Â∑≤Â§çÂà∂", btnClear: "Ê∏ÖÈô§", btnExport: "ÂØºÂá∫", btnImport: "ÂØºÂÖ•", btnReset: "ÈáçÁΩÆ", addRow: "+ Ê∑ªÂä†Ë°å", copyAll: "Â§çÂà∂ÂÖ®ÈÉ®", calcTitle: "ËÆ°ÁÆóÂô®", btnSave: "‰øùÂ≠ò", confirmReset: "ÂÖ®ÈÉ®ÈáçÁΩÆÔºü" },
            ko: { proGuide: "ÌîÑÎ°ú Ï†ÑÏö©: Í∏∞Í∏∞ ÎÇ¥ Ï†ÄÏû• Î∞è Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞Í∞Ä Í∞ÄÎä•Ìï©ÎãàÎã§.", modeBase: "Í∏∞Ï§ÄÍ∞íÏóêÏÑú", descBase: "Í≥†Ï†ï Ï∞∏Ï°∞: Î™®Îì† ÌñâÏù¥ ÏµúÏÉÅÎã®Ïùò Í∏∞Ï§ÄÍ∞íÏùÑ Ï∞∏Ï°∞ÌïòÏó¨ Í≥ÑÏÇ∞Ìï©ÎãàÎã§", modePrev: "ÌîåÎ°úÏö∞ Î™®Îìú", descPrev: "ÏúÑÏóêÏÑú ÏïÑÎûòÎ°ú ÏàúÏ∞®Ï†Å Í≥ÑÏÇ∞. Í∞Å ÌñâÏóêÏÑú üè† ÎòêÎäî üîó ÏÑ†ÌÉù Í∞ÄÎä•.", masterLabelName: "Ïù¥Î¶Ñ:", masterLabelStart: "Í∏∞Ï§Ä Ïà´Ïûê", copyMsg: "Î≥µÏÇ¨Îê®", btnClear: "ÏßÄÏö∞Í∏∞", btnExport: "ÎÇ¥Î≥¥ÎÇ¥Í∏∞", btnImport: "Í∞ÄÏ†∏Ïò§Í∏∞", btnReset: "Ï¥àÍ∏∞Ìôî", addRow: "+ Ìñâ Ï∂îÍ∞Ä", copyAll: "Ï†ÑÏ≤¥ Î≥µÏÇ¨", calcTitle: "Í≥ÑÏÇ∞Í∏∞", btnSave: "Ï†ÄÏû•", confirmReset: "Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?" },
            es: { proGuide: "PRO a√±ade: Guardado local y exportaci√≥n/importaci√≥n de datos.", modeBase: "Desde Base", descBase: "Referencia fija: cada fila se refiere al valor inicial superior", modePrev: "Flujo", descPrev: "Evaluado de arriba a abajo. Elige üè† o üîó para cada fila.", masterLabelName: "Nombre:", masterLabelStart: "Valor Base", copyMsg: "¬°Copiado!", btnClear: "Limpiar", btnExport: "Exportar", btnImport: "Importar", btnReset: "Reiniciar", addRow: "+ Fila", copyAll: "Copiar todo", calcTitle: "Calculadora", btnSave: "Guardar", confirmReset: "¬øReiniciar?" },
            fr: { proGuide: "PRO ajoute : Sauvegarde locale et export/import de donn√©es.", modeBase: "Depuis Base", descBase: "R√©f√©rence fixe : chaque ligne se r√©f√®re √† la valeur initiale du haut", modePrev: "Flux", descPrev: "√âvalu√© de haut en bas. Choisissez üè† ou üîó pour chaque ligne.", masterLabelName: "Nom :", masterLabelStart: "Valeur de base", copyMsg: "Copi√© !", btnClear: "Effacer", btnExport: "Export", btnImport: "Import", btnReset: "Reset", addRow: "+ Ligne", copyAll: "Tout copier", calcTitle: "Calculatrice", btnSave: "Enregistrer", confirmReset: "Tout r√©initialiser ?" },
            pt: { proGuide: "O PRO adiciona: Salvamento local e exporta√ß√£o/importa√ß√£o de dados.", modeBase: "Da Base", descBase: "Refer√™ncia fixa: cada linha refere-se ao valor inicial no topo", modePrev: "Fluxo", descPrev: "Avaliado de cima para baixo. Escolha üè† ou üîó para cada linha.", masterLabelName: "Nome:", masterLabelStart: "Valor Base", copyMsg: "Copiado!", btnClear: "Limpiar", btnExport: "Exportar", btnImport: "Importar", btnReset: "Reset", addRow: "+ Linha", copyAll: "Copiar tudo", calcTitle: "Calculadora", btnSave: "Salvar", confirmReset: "Resetar tudo?" },
            de: { proGuide: "PRO bietet zus√§tzlich: Lokales Speichern und Daten-Export/Import.", modeBase: "Vom Basiswert", descBase: "Feste Referenz: Jede Zeile bezieht sich auf den obersten Basiswert", modePrev: "Flow", descPrev: "Berechnung von oben nach unten. W√§hlen Sie üè† oder üîó f√ºr jede Zeile.", masterLabelName: "Name:", masterLabelStart: "Basiswert", copyMsg: "Kopiert!", btnClear: "L√∂schen", btnExport: "Export", btnImport: "Import", btnReset: "Reset", addRow: "+ Zeile", copyAll: "Alles kopieren", calcTitle: "Rechner", btnSave: "Speichern", confirmReset: "Alles zur√ºcksetzen?" },
            it: { proGuide: "PRO aggiunge: Salvataggio locale ed esportazione/importazione dati.", modeBase: "Dalla Base", descBase: "Riferimento fisso: ogni riga si riferisce al valore iniziale in alto", modePrev: "Flusso", descPrev: "Valutato dall'alto verso il basso. Scegli üè† o üîó per ogni riga.", masterLabelName: "Name:", masterLabelStart: "Valore Base", copyMsg: "Copiado!", btnClear: "Cancella", btnExport: "Esporta", btnImport: "Importa", btnReset: "Reset", addRow: "+ Riga", copyAll: "Copia tutto", calcTitle: "Calcolatrice", btnSave: "Salva", confirmReset: "Reset completo?" }
        };

        let currentLanguage = 'ja'; 
        let currentCalc = "0";

        function showProGuide() {
            const m = document.getElementById('saveMessage');
            m.style.background = "#dc3545"; 
            m.textContent = languageMap[currentLanguage].proGuide;
            m.style.opacity = 1;
            setTimeout(() => m.style.opacity = 0, 4000);
        }

        // ‰øùÂ≠ò„ÉªÂÖ•Âá∫ÂäõÊ©üËÉΩ„ÇíË™òÂ∞é„Å´ÁΩÆ„ÅçÊèõ„Åà
        function saveToMemory() { showProGuide(); }
        function exportData() { showProGuide(); }
        function importData() { showProGuide(); }
        function toggleEditMode() { showProGuide(); }
        function renderSaveList() { } // FreeÁâà„ÅØÂ∏∏„Å´Á©∫

        // --- ‰ª•‰∏ã„ÄÅË®àÁÆó„É≠„Ç∏„ÉÉ„ÇØÔºà„Éó„É≠Áâà„Å®100%Âêå‰∏ÄÔºâ ---
        function init() {
            const langCont = document.getElementById('langContainer');
            Object.keys(languageMap).forEach(lang => {
                const btn = document.createElement('button');
                btn.style.cssText = "padding:4px 6px; font-size:11px; cursor:pointer; border:1px solid #ccc; border-radius:4px; background:#fff; font-weight:bold; color:#000;";
                btn.textContent = lang.toUpperCase();
                btn.onclick = () => setLanguage(lang);
                langCont.appendChild(btn);
            });
            addRowSmart(); addRowSimple(); setLanguage('ja');
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            const d = languageMap[lang];
            document.getElementById('txtModeBase').textContent = d.modeBase;
            document.getElementById('descModeBase').textContent = d.descBase;
            document.getElementById('txtModePrev').textContent = d.modePrev;
            document.getElementById('descModePrev').textContent = d.descPrev;
            document.getElementById('labelNameSpan').textContent = d.masterLabelName;
            document.getElementById('masterLabelStart').textContent = d.masterLabelStart;
            document.getElementById('masterLabelStartSimple').textContent = d.masterLabelStart;
            document.getElementById('btnClear').textContent = d.btnClear;
            document.getElementById('btnExport').textContent = d.btnExport;
            document.getElementById('btnImport').textContent = d.btnImport;
            document.getElementById('btnReset').textContent = d.btnReset;
            document.getElementById('addBtnInd').textContent = d.addRow;
            document.getElementById('addBtnSeq').textContent = d.addRow;
            document.getElementById('copyBtnInd').textContent = d.copyAll;
            document.getElementById('copyBtnSeq').textContent = d.copyAll;
            document.getElementById('ui-calcTitle').textContent = d.calcTitle;
            document.getElementById('btnSaveMemory').textContent = d.btnSave;
            updateDisplay();
        }

        function updateDisplay() {
            const mVal = parseFloat(document.getElementById('masterInput').value)||0;
            document.querySelectorAll('#rows-container-smart .row').forEach(r => {
                const id = r.dataset.id, op=document.getElementById('smart-op-'+id).textContent, mult=parseFloat(r.querySelector('.multiplier-input').value)||0, pct=r.querySelector('.percent-toggle').classList.contains('active');
                let mod=pct?mVal*(mult/100):mult, res=0;
                if(op==='+') res=mVal+mod; else if(op==='-') res=mVal-mod; else if(op==='√ó') res=pct?mVal*(mult/100):mVal*mult; else if(op==='√∑') res=mult!==0?mVal/mult:0;
                r.querySelector('.result-text').textContent = Math.round(res).toLocaleString();
            });
            const mValS = parseFloat(document.getElementById('masterInputSimple').value)||0;
            let chain = mValS;
            document.querySelectorAll('#rows-container-simple .row').forEach(r => {
                const id = r.dataset.id, op=document.getElementById('simple-op-'+id).textContent, mult=parseFloat(r.querySelector('.multiplier-input').value)||0, pct=r.querySelector('.percent-toggle').classList.contains('active');
                const base = document.getElementById('simple-base-'+id).classList.contains('chain') ? chain : mValS;
                let mod=pct?base*(mult/100):mult, res=0;
                if(op==='+') res=base+mod; else if(op==='-') res=base-mod; else if(op==='√ó') res=pct?base*(mult/100):base*mult; else if(op==='√∑') res=mult!==0?base/mult:0;
                r.querySelector('.result-text').textContent = Math.round(res).toLocaleString();
                chain = res;
            });
        }

        function addRowSmart() {
            const id = Math.random().toString(36).substr(2, 5);
            const div = document.createElement('div'); div.className='row'; div.dataset.id=id;
            div.innerHTML = `<input type="text" class="text-label-input" placeholder="Label"><div class="calc-area"><div class="operator-group"><div class="operator-control" onclick="changeOp('${id}','smart',1)">‚ñ≤</div><div class="operator-display" id="smart-op-${id}">+</div><div class="operator-control" onclick="changeOp('${id}','smart',-1)">‚ñº</div></div><input type="number" class="multiplier-input" value="0" oninput="updateDisplay()"><div class="percent-toggle" onclick="this.classList.toggle('active');updateDisplay()">%</div></div><div class="result-area"><div class="result-text">0</div><div style="display:flex; gap:10px;"><button class="action-btn" onclick="copyRowVal(this)">üìã</button><button class="action-btn" onclick="this.closest('.row').remove();updateDisplay()">üóëÔ∏è</button></div></div>`;
            document.getElementById('rows-container-smart').appendChild(div); updateDisplay();
        }

        function addRowSimple() {
            const id = Math.random().toString(36).substr(2, 5);
            const div = document.createElement('div'); div.className='row'; div.dataset.id=id;
            div.innerHTML = `<input type="text" class="text-label-input" placeholder="Label"><div class="calc-area"><div id="simple-base-${id}" class="base-toggle chain" onclick="this.classList.toggle('chain');this.textContent=this.classList.contains('chain')?'üîó':'üè†';updateDisplay()">üîó</div><div class="operator-group"><div class="operator-control" onclick="changeOp('${id}','simple',1)">‚ñ≤</div><div class="operator-display" id="simple-op-${id}">+</div><div class="operator-control" onclick="changeOp('${id}','simple',-1)">‚ñº</div></div><input type="number" class="multiplier-input" value="0" oninput="updateDisplay()"><div class="percent-toggle" onclick="this.classList.toggle('active');updateDisplay()">%</div></div><div class="result-area"><div class="result-text">0</div><div style="display:flex; gap:10px;"><button class="action-btn" onclick="copyRowVal(this)">üìã</button><button class="action-btn" onclick="this.closest('.row').remove();updateDisplay()">üóëÔ∏è</button></div></div>`;
            document.getElementById('rows-container-simple').appendChild(div); updateDisplay();
        }

        function changeOp(id,m,d){ const ops=['+','-','√ó','√∑']; const el=document.getElementById(m+'-op-'+id); el.textContent=ops[(ops.indexOf(el.textContent)+d+4)%4]; updateDisplay(); }
        function switchMode(m){ document.getElementById('smart-sheet-mode').style.display=m==='smartSheet'?'block':'none'; document.getElementById('custom-simple-mode').style.display=m==='customSimple'?'block':'none'; document.getElementById('smartSheetBtn').classList.toggle('active',m==='smartSheet'); document.getElementById('customSimpleBtn').classList.toggle('active',m==='customSimple'); updateDisplay(); }
        function copyRowVal(btn){ navigator.clipboard.writeText(btn.closest('.result-area').querySelector('.result-text').textContent.replace(/,/g,'')); showMsg(languageMap[currentLanguage].copyMsg); }
        function copyPage(m){ let t = `„Äê${document.getElementById('masterLabel').value || 'Sheet'}„Äë\n`; const container = m === 'smart' ? '#rows-container-smart' : '#rows-container-simple'; document.querySelectorAll(container + ' .row').forEach(r => { t += `${r.querySelector('.text-label-input').value || '-'}\t${r.querySelector('.result-text').textContent.replace(/,/g,'')}\n`; }); navigator.clipboard.writeText(t); showMsg(languageMap[currentLanguage].copyMsg); }
        function calcInput(v) { if(currentCalc==="0" && v!==".") currentCalc=v; else currentCalc+=v; document.getElementById('calcDisplay').value=currentCalc; }
        function calcClear() { currentCalc="0"; document.getElementById('calcDisplay').value="0"; }
        function calcResult() { try { let res = eval(currentCalc.replace(/√ó/g, '*').replace(/√∑/g, '/')); currentCalc = Number.isInteger(res) ? res.toString() : parseFloat(res.toFixed(8)).toString(); } catch(e) { currentCalc="Error"; } document.getElementById('calcDisplay').value=currentCalc; }
        function copyCalcResult() { navigator.clipboard.writeText(document.getElementById('calcDisplay').value); showMsg(languageMap[currentLanguage].copyMsg); }
        function toggleCalc() { document.getElementById('sideCalc').classList.toggle('active'); }
        function clearNumbers(){ document.getElementById('masterInput').value=0; document.getElementById('masterInputSimple').value=0; document.querySelectorAll('.multiplier-input').forEach(i=>i.value=0); updateDisplay(); }
        function fullReset(){ if(confirm(languageMap[currentLanguage].confirmReset)){ location.reload(); } }
        function showMsg(t){ const m=document.getElementById('saveMessage'); m.style.background="#000"; m.textContent=t; m.style.opacity=1; setTimeout(()=>m.style.opacity=0, 1500); }
    </script>
</body>
</html>
